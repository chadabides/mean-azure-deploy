!function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={exports:{},id:o,loaded:!1};return e[o].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){(function(e){"use strict";function t(e){return e&&e.__esModule?e:{"default":e}}var o=n(1),r=t(o),i=n(2),u=t(i),a=n(3),s=t(a),l=n(4),c=(t(l),n(5)),f=t(c),d=n(6),p=t(d),v=n(7),m=t(v),g=n(10),b=t(g),h=n(9),_=t(h),w=new b["default"];w.cfg({consoleLevel:"debug",fileLevel:"error"}),_["default"].connect("mongodb://api:!AgileRules4#@ds062059.mlab.com:62059/mic-pro").then(function(){w.log("Database is connected")})["catch"](function(e){w.log(e,"error")});var y=process.env.PORT||3e3,x=(0,r["default"])();x.use((0,s["default"])()),x.use(r["default"]["static"]("dist")),x.use("/app",r["default"]["static"]("./src/client/app")),x.use(f["default"].urlencoded({extended:!0})),x.use(f["default"].json()),x.use((0,p["default"])()),x.use(w.dev),x.set("view engine","ejs"),x.set("views",u["default"].join(e,"../src/server/views/")),x.use("/movies",m["default"]),x.use("/errortest",function(e,t,n){var o={message:"Test route is Testing Error Route",status:509,stack:[{message:"An error test",status:505},{message:"From the Movie test error page",status:501}]};n(o)}),x.use(function(e,t,n,o){w.log(e,"error"),n.status(e.status||500),n.render("pages/error.ejs",{message:e.message,error:{}})}),x.listen(y,function(e){w.log("application started on Port:"+y,"info"),e&&w.log(e)})}).call(t,"/")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("compression")},function(e,t){e.exports=require("cookie-parser")},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("method-override")},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),i=o(r),u=n(8),a=o(u),s=n(10),l=o(s),c=i["default"].Router(),f=new a["default"];new l["default"];c.get("/",f.get),c.post("/",f.save),c.put("/",f.save),c.get("/:id",f.getbyId),c["delete"]("/:id",f.remove),t["default"]=c},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=n(9),u=o(i),a=n(10),s=o(a),l=n(16),c=o(l),f=new s["default"],d=function p(){r(this,p),f.log("Starting Movie AP","debug");var e=function(e,t,n){u["default"].db.collection("movies").find().toArray().then(function(e){t.json(e)})["catch"](function(e){f.log("Mongo has a problem: "+e,"debug"),n(e)})},t=function(e,t,n){var o=e.body;o._id&&(o._id=new c["default"].ObjectID(o._id.trim())),u["default"].db.collection("movies").save(e.body).then(function(e){null===e?(f.log("Errror on Save adding Movie to the database","debug"),n("Result was null")):t.json(e)})["catch"](function(e){f.log("Mongo has a problem: "+e,"debug"),n(e)})},n=function(e,t,n){f.log("Trying to remove movie is: "+e.params.id.trim(),"info");var o=new c["default"].ObjectID(e.params.id.trim());u["default"].db.collection("movies").remove({_id:o}).then(function(){t.sendStatus(200)})["catch"](function(e){f.log("Mongo has a problem: "+e,"debug"),n(e)})},o=function(e,t,n){var o=new c["default"].ObjectID(e.params.id.trim());u["default"].db.collection("movies").findOne(o).then(function(e){f.log("the movie is "+JSON.stringify(e),"debug"),null===e?(f.log("No record Found","debug"),n("Result was null")):t.json(e)})["catch"](function(e){f.log("Mongo has a problem: "+e,"debug"),n(e)})},i={get:e,getbyId:o,save:t,remove:n};return i};t["default"]=d},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),u=n(10),a=o(u),s=n(16),l=o(s),c=new a["default"],f="",d=function(){function e(){r(this,e)}return i(e,null,[{key:"connect",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"mongodb://apiuser:!Agile$@ds117839.mlab.com:17839/live-exam-practice";return f=t,l["default"].MongoClient.connect(f).then(function(t){c.log("successful db connection","info"),e.db=t})["catch"](function(e){c.error(e,"error")})}}]),e}();Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=d},function(e,t,n){(function(e){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),u=n(11),a=(o(u),n(2)),s=o(a),l=n(12),c=o(l),f=n(13),d=o(f),p=n(14),v=o(p),m=n(15),g=o(m),b=Symbol("winston"),h=null,_={consoleLevel:"info",fileLevel:"error"},w=function(){function t(){var n=this;if(r(this,t),!h){this._timeStamp=this.time;var o=function(){return(0,g["default"])().format("YYYY-MM-DD h:mm:ss a")};d["default"].token("id",function(e){return e.id});var i=s["default"].join(e,"log"),u=(0,c["default"])("request.log",{interval:"1d",path:i});this[b]=new v["default"].Logger({transports:[new v["default"].transports.File({level:_.fileLevel,filename:"app.log",handleExceptions:!0,json:!0,maxsize:5242880,maxFiles:5,colorize:!1,timestamp:!0,prettyprint:!0}),new v["default"].transports.Console({level:_.consoleLevel,handleExceptions:!0,json:!1,colorize:!0})],exitOnError:!1});var a=function(e){_=e,n[b].transports.console.level=e.consoleLevel,n[b].transports.file.level=e.fileLevel},l={timeStamp:this._timeStamp,time:o,log:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";n[b].log(t,e)},cfg:a,dev:(0,d["default"])(":id :method :status :url :response-time[3]",{stream:u})};h=l}return h}return i(t,[{key:"timeStamp",get:function(){return this._timeStamp}}]),t}();t["default"]=w}).call(t,"/")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("rotating-file-stream")},function(e,t){e.exports=require("morgan")},function(e,t){e.exports=require("winston")},function(e,t){e.exports=require("moment")},function(e,t){e.exports=require("mongodb")}]);
//# sourceMappingURL=server.js.map